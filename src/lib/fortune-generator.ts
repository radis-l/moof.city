import type { UserData, FortuneResult, AgeRange, BirthDay, BloodGroup } from '@/types'

// Fortune generation based on user data
export const generateFortune = (userData: UserData): FortuneResult => {
  const { ageRange, birthDay, bloodGroup } = userData

  // Generate lucky number based on user data
  const luckyNumber = generateLuckyNumber(ageRange, birthDay, bloodGroup)

  // Generate personalized predictions
  const relationship = generateRelationshipFortune(birthDay, bloodGroup)
  const work = generateWorkFortune(ageRange, birthDay)
  const health = generateHealthFortune(bloodGroup, ageRange)

  return {
    luckyNumber,
    relationship,
    work,
    health,
    generatedAt: new Date().toISOString()
  }
}

// Generate single lucky number (2-digits: 10-99) based on user attributes
const generateLuckyNumber = (
  ageRange: string,
  birthDay: string,
  bloodGroup: string
): number => {
  // Create seed from user data for consistent results
  const ageMultiplier = getAgeMultiplier(ageRange as AgeRange)
  const dayMultiplier = getDayMultiplier(birthDay as BirthDay)
  const bloodMultiplier = getBloodMultiplier(bloodGroup as BloodGroup)

  // Generate lucky number between 10-99 (2 digits)
  const seed = (ageMultiplier + dayMultiplier + bloodMultiplier) % 90 + 10
  const luckyNumber = ((seed * 17) % 90) + 10

  return luckyNumber
}

// Generate relationship fortune using birthDay + bloodGroup combination
const generateRelationshipFortune = (
  birthDay: string,
  bloodGroup: string
): string => {
  // Base fortunes focused on life events and introspection
  const dayRelationshipMessages = {
    'Monday': [
      'ใครบางคนในอดีตอาจกลับมา ทบทวนความรู้สึกตัวเองให้ดีก่อนตัดสินใจ อย่ารีบร้อน',
      'ความสัมพันธ์ที่คลุมเครือจะชัดเจนขึ้นในไม่ช้า เตรียมใจยอมรับความจริงที่จะเกิดขึ้น',
      'การใส่ใจในรายละเอียดเล็กๆ น้อยๆ จะช่วยเยียวยาความสัมพันธ์ที่ห่างเหินให้กลับมาดี'
    ],
    'Tuesday': [
      'ความใจร้อนอาจนำไปสู่ความขัดแย้งที่ไม่จำเป็น ควรใช้เหตุผลมากกว่าอารมณ์ในการสื่อสาร',
      'พลังเสน่ห์ของคุณกำลังเปล่งประกาย อาจมีคนใหม่ๆ เข้ามาในชีวิตอย่างไม่คาดฝัน',
      'ความกล้าที่จะเปิดใจจะนำพาความสัมพันธ์ไปสู่อีกระดับหนึ่ง อย่ากลัวที่จะแสดงความรู้สึก'
    ],
    'Wednesday': [
      'การสื่อสารคือหัวใจสำคัญในสัปดาห์นี้ การพูดคุยจะคลี่คลายปมในใจที่ค้างคามานาน',
      'ใครบางคนกำลังจับตามองคุณอยู่ ลองสังเกตคนรอบข้าง อาจมีเรื่องน่าประหลาดใจรออยู่',
      'คุณอาจต้องเป็นคนกลางในการไกล่เกลี่ยปัญหาของคนใกล้ชิด ใช้สติปัญญาของคุณให้เป็นประโยชน์'
    ],
    'Thursday': [
      'ผู้ใหญ่จะเข้ามามีบทบาทในความสัมพันธ์ของคุณ อาจเป็นคำแนะนำที่ดีหรือการช่วยเหลือ',
      'โอกาสดีๆ ในเรื่องความรักกำลังจะเข้ามา อย่าปิดกั้นตัวเองจากสิ่งใหม่ๆ ที่จะเกิดขึ้น',
      'ความซื่อสัตย์และความจริงใจของคุณจะได้รับการตอบแทน ทำให้ความสัมพันธ์มั่นคงและยั่งยืน'
    ],
    'Friday': [
      'เสน่ห์ของคุณโดดเด่นเป็นพิเศษในวันนี้ เหมาะกับการสร้างความประทับใจให้ใครบางคน',
      'ความสัมพันธ์ที่ตึงเครียดจะผ่อนคลายลง บรรยากาศจะกลับมาอบอุ่นและเป็นมิตรอีกครั้ง',
      'ระวังคำพูดที่อาจทำร้ายจิตใจคนรักโดยไม่ตั้งใจ ความอ่อนโยนจะช่วยรักษาทุกสิ่ง'
    ],
    'Saturday': [
      'ถึงเวลาสร้างความมั่นคงในความสัมพันธ์ การพูดคุยเรื่องอนาคตจะทำให้ความรักแน่นแฟ้นขึ้น',
      'ความอดทนของคุณกำลังจะสิ้นสุดลงกับปัญหาเดิมๆ ถึงเวลาต้องตัดสินใจอย่างเด็ดขาด',
      'คุณอาจรู้สึกโดดเดี่ยว แต่จริงๆ แล้วมีคนคอยเป็นห่วงอยู่ใกล้ๆ ลองเปิดใจมองดู'
    ],
    'Sunday': [
      'ความเป็นผู้นำของคุณจะนำทางความสัมพันธ์ แต่ก็อย่าลืมรับฟังความคิดเห็นของอีกฝ่าย',
      'การเสียสละเล็กๆ น้อยๆ จะสร้างความประทับใจที่ยิ่งใหญ่ให้กับคนรักของคุณในวันนี้',
      'คุณจะเป็นที่พึ่งทางใจให้กับคนรอบข้าง แต่ก็อย่าลืมดูแลหัวใจของตัวเองด้วยเช่นกัน'
    ]
  }

  // Modifiers based on inherent personality traits
  const bloodModifiers = {
    'A': [
        ' ด้วยความรอบคอบของคุณ จงเชื่อในสัญชาตญาณเมื่อต้องตัดสินใจเรื่องสำคัญ',
        ' ความใส่ใจในรายละเอียดของคุณจะช่วยป้องกันไม่ให้เกิดความผิดพลาดเล็กๆ น้อยๆ',
        ' อย่าเก็บความกังวลไว้คนเดียว การแบ่งปันจะทำให้คุณรู้สึกดีขึ้นอย่างไม่น่าเชื่อ'
    ],
    'B': [
        ' ความเป็นอิสระของคุณคือเสน่ห์ แต่อย่าลืมแสดงให้คนรักเห็นว่าเขาสำคัญกับคุณ',
        ' ความคิดสร้างสรรค์ของคุณจะช่วยแก้ปัญหาที่ดูเหมือนจะตันได้อย่างน่าทึ่ง',
        ' บางครั้งการทำตามใจตัวเองก็ไม่ใช่เรื่องผิด จงเชื่อมั่นในการตัดสินใจของตนเอง'
    ],
    'AB': [
        ' ความสามารถในการปรับตัวของคุณจะช่วยให้ผ่านสถานการณ์ที่น่าอึดอัดไปได้ด้วยดี',
        ' คุณมองเห็นทางออกที่คนอื่นมองไม่เห็น จงกล้าที่จะเสนอความคิดเห็นที่แตกต่าง',
        ' อย่าพยายามเข้าใจทุกอย่างด้วยเหตุผล บางครั้งความรู้สึกก็คือคำตอบที่ดีที่สุด'
    ],
    'O': [
        ' พลังงานบวกของคุณจะดึงดูดสิ่งดีๆ เข้ามา จงแบ่งปันความสดใสนั้นให้คนรอบข้าง',
        ' ความเป็นผู้นำของคุณจะถูกทดสอบ แต่คุณจะสามารถนำพาให้ทุกอย่างผ่านไปได้',
        ' การปกป้องคนที่คุณรักคือสิ่งสำคัญ แต่อย่าลืมให้พื้นที่ส่วนตัวกับพวกเขาด้วย'
    ]
  }

  const dayMessages = dayRelationshipMessages[birthDay as keyof typeof dayRelationshipMessages] || dayRelationshipMessages['Monday']
  const bloodModifierMessages = bloodModifiers[bloodGroup as keyof typeof bloodModifiers] || bloodModifiers['A']

  // Combine a random birth day message + a random blood group modifier
  const baseMessage = dayMessages[Math.floor(Math.random() * dayMessages.length)]
  const bloodModifier = bloodModifierMessages[Math.floor(Math.random() * bloodModifierMessages.length)]

  return baseMessage + bloodModifier
}

// Generate work fortune
const generateWorkFortune = (
  ageRange: string,
  birthDay: string
): string => {
  const workTemplates = {
    '<18': [
      'ทักษะใหม่ที่กำลังเรียนรู้จะเปิดโอกาสสำคัญในอนาคต ตั้งใจฝึกฝนต่อไปแล้วจะดีเอง',
      'ความขยันหมั่นเพียรของคุณกำลังเป็นที่จับตามองของผู้ใหญ่ เตรียมรับข่าวดีเร็วๆ นี้',
      'อย่ากลัวที่จะถามในสิ่งที่ไม่รู้ การเรียนรู้จะนำพาคุณไปสู่ความสำเร็จที่ยิ่งใหญ่'
    ],
    '18-25': [
      'อุปสรรคที่เจออยู่ตอนนี้คือบททดสอบศักยภาพที่แท้จริงของคุณ จงเชื่อมั่นและก้าวผ่านไป',
      'โอกาสในการแสดงความสามารถกำลังจะมาถึง เตรียมตัวให้พร้อม แล้วคุณจะโดดเด่นกว่าใคร',
      'การสร้างเครือข่ายกับเพื่อนร่วมงานหรือเพื่อนร่วมรุ่นจะส่งผลดีต่ออนาคตอย่างไม่คาดคิด'
    ],
    '26-35': [
      'ความสำเร็จกำลังจะมาถึง อาจมาจากทิศทางที่ไม่คาดคิด จงตั้งใจทำงานของคุณต่อไป',
      'การตัดสินใจครั้งสำคัญเกี่ยวกับการงานกำลังรออยู่ ชั่งน้ำหนักข้อดีข้อเสียให้รอบคอบ',
      'ผลงานของคุณจะได้รับการยอมรับในวงกว้าง อาจมีโอกาสได้เลื่อนตำแหน่งหรือขึ้นเงินเดือน'
    ],
    '36-45': [
      'การตัดสินใจเรื่องการเงินครั้งสำคัญกำลังรออยู่ ใช้ประสบการณ์ของคุณแต่อย่าลืมปรึกษาผู้รู้',
      'ความมั่นคงในอาชีพการงานของคุณกำลังเพิ่มขึ้น เป็นผลมาจากความทุ่มเทที่ผ่านมา',
      'อาจมีคนชวนให้ลงทุนหรือทำธุรกิจใหม่ ควรศึกษาข้อมูลให้ดีก่อนตัดสินใจเข้าร่วม'
    ],
    '46-55': [
      'ประสบการณ์ของคุณคือสมบัติล้ำค่า การให้คำแนะนำใครบางคนจะนำมาซึ่งผลตอบแทนที่ดี',
      'คุณอาจรู้สึกหมดไฟ แต่เร็วๆ นี้จะมีโปรเจกต์ใหม่เข้ามาปลุกพลังในตัวคุณอีกครั้ง',
      'ระวังความขัดแย้งกับเพื่อนร่วมงานที่อายุน้อยกว่า การรับฟังจะช่วยลดช่องว่างระหว่างวัย'
    ],
    '55+': [
      'ถึงเวลาเก็บเกี่ยวผลลัพธ์จากสิ่งที่เคยทำไว้ โครงการเก่าๆ จะกลับมาสร้างประโยชน์ให้คุณ',
      'ประสบการณ์ของคุณเป็นที่ต้องการของคนรุ่นใหม่ การถ่ายทอดความรู้จะสร้างความสุขใจ',
      'การเงินมั่นคง มีเกณฑ์ได้รับผลตอบแทนจากการลงทุนระยะยาวที่ได้ทำไว้ในอดีต'
    ]
  }

  const dayModifiers = {
    'Monday': [
        'ความคิดสร้างสรรค์ของคุณจะเปล่งประกาย ลองนำเสนอไอเดียใหม่ๆ แล้วจะได้รับการยอมรับ',
        'การเจรจาต่อรองจะราบรื่นเป็นพิเศษในสัปดาห์นี้ ใช้เสน่ห์ของคุณให้เป็นประโยชน์',
        'อย่าลังเลที่จะขอความช่วยเหลือ การทำงานร่วมกับผู้อื่นจะนำมาซึ่งความสำเร็จ'
    ],
    'Tuesday': [
        'พลังงานที่เต็มเปี่ยมของคุณจะส่งผลดีต่องานที่ต้องใช้ความกระตือรือร้นและความเร็ว',
        'ความมุ่งมั่นของคุณจะช่วยให้ผ่านอุปสรรคที่ท้าทายไปได้ อย่าเพิ่งยอมแพ้',
        'วันนี้เหมาะสำหรับการเริ่มต้นโปรเจกต์ใหม่ๆ ไฟของคุณกำลังลุกโชนและพร้อมลุย'
    ],
    'Wednesday': [
        'ทักษะการสื่อสารของคุณจะโดดเด่นเป็นพิเศษ เหมาะแก่การนำเสนองานหรือเจรจาธุรกิจ',
        'ความฉลาดและไหวพริบของคุณจะช่วยแก้ปัญหาเฉพาะหน้าได้อย่างยอดเยี่ยมและน่าทึ่ง',
        'เป็นวันที่ดีในการเรียนรู้สิ่งใหม่ๆ หรือพัฒนาทักษะเพิ่มเติมเพื่ออนาคต'
    ],
    'Thursday': [
        'ผู้ใหญ่จะให้การสนับสนุนและมองเห็นความสามารถของคุณ อย่าลืมแสดงความอ่อนน้อมถ่อมตน',
        'โชคจะเข้าข้างคุณในเรื่องการงาน อาจมีโอกาสดีๆ เข้ามาโดยไม่คาดคิดมาก่อน',
        'ความซื่อสัตย์ของคุณจะนำพาความไว้วางใจจากเพื่อนร่วมงานและหัวหน้ามาให้'
    ],
    'Friday': [
        'บรรยากาศในการทำงานจะผ่อนคลายและเป็นมิตร ทำให้คุณทำงานได้อย่างมีความสุข',
        'ความมีรสนิยมของคุณจะช่วยให้งานที่เกี่ยวกับความคิดสร้างสรรค์ออกมาโดดเด่น',
        'การสร้างความสัมพันธ์ที่ดีกับคนในที่ทำงานจะส่งผลดีต่อความก้าวหน้าของคุณ'
    ],
    'Saturday': [
        'วันนี้เหมาะกับการวางแผนระยะยาว ความรอบคอบของคุณจะทำให้แผนงานรัดกุมและสำเร็จ',
        'ความอดทนของคุณจะทำให้งานที่ต้องใช้เวลายาวนานสำเร็จลุล่วงไปได้ด้วยดี',
        'แม้จะเจออุปสรรค แต่คุณจะสามารถผ่านไปได้ด้วยความสุขุมและความรับผิดชอบ'
    ],
    'Sunday': [
        'ความเป็นผู้นำของคุณจะทำให้เป็นที่รักของเพื่อนร่วมงานและลูกน้องในทีม',
        'การช่วยเหลือผู้อื่นในวันนี้จะนำพาโอกาสดีๆ กลับมาให้คุณในอนาคตอย่างแน่นอน',
        'คุณจะเต็มเปี่ยมไปด้วยพลังบวกและความกระตือรือร้นในการทำงานในสัปดาห์ใหม่'
    ]
  }

  const ageTemplates = workTemplates[ageRange as keyof typeof workTemplates] || workTemplates['26-35']
  const dayModifierMessages = dayModifiers[birthDay as keyof typeof dayModifiers] || dayModifiers['Monday']

  const baseMessage = ageTemplates[Math.floor(Math.random() * ageTemplates.length)]
  const dayMessage = dayModifierMessages[Math.floor(Math.random() * dayModifierMessages.length)]

  return `${baseMessage} ${dayMessage}`
}

// Generate health fortune
const generateHealthFortune = (
  bloodGroup: string,
  ageRange: string
): string => {
  const healthTemplates = {
    A: [
      'ความเครียดสะสมโดยไม่รู้ตัวกำลังส่งผลต่อร่างกาย หาเวลาสงบใจและพักผ่อนให้มากขึ้น',
      'ระบบย่อยอาหารอาจมีปัญหา ควรหลีกเลี่ยงอาหารรสจัดและเลือกทานอาหารที่ย่อยง่าย',
      'คุณมีแนวโน้มที่จะคิดมากเกินไป การปล่อยวางจะช่วยให้สุขภาพจิตและกายดีขึ้น'
    ],
    B: [
      'พลังงานในร่างกายไม่คงที่ ควรรับฟังร่างกายว่าต้องการพักผ่อนหรือสารอาหาร',
      'ระวังเรื่องภูมิแพ้ที่อาจกำเริบในช่วงนี้ หลีกเลี่ยงสิ่งที่กระตุ้นให้เกิดอาการ',
      'การไหลเวียนของเลือดดี แต่ควรออกกำลังกายสม่ำเสมอเพื่อรักษาสภาพร่างกายให้แข็งแรง'
    ],
    'AB': [
      'ช่วงนี้อารมณ์อ่อนไหวง่าย ควรหลีกเลี่ยงสถานการณ์ที่บั่นทอนพลังงานและจิตใจของคุณ',
      'ร่างกายของคุณต้องการความสมดุล การทำสมาธิหรือโยคะจะช่วยให้รู้สึกดีขึ้นมาก',
      'ระบบภูมิคุ้มกันอาจอ่อนแอลง ควรนอนหลับให้เพียงพอและทานวิตามินเสริม'
    ],
    'O': [
      'ร่างกายแข็งแรงดี แต่ต้องใส่ใจเรื่องข้อต่อและกระดูก การออกกำลังกายเบาๆ จะช่วยได้มาก',
      'ระบบเผาผลาญทำงานได้ดี แต่ก็ควรควบคุมการทานของหวานและของมันเพื่อสุขภาพ',
      'คุณมีพลังงานล้นเหลือ แต่อย่าหักโหมจนเกินไป แบ่งเวลาพักผ่อนให้ร่างกายได้ฟื้นฟู'
    ]
  }

  const ageAdvice = {
    '<18': [
        'การนอนหลับให้เพียงพอสำคัญมากสำหรับวัยที่กำลังเจริญเติบโต พยายามเข้านอนให้เป็นเวลา',
        'อย่าลืมดื่มน้ำให้เพียงพอและกินอาหารที่มีประโยชน์ การดูแลตัวเองตอนนี้จะส่งผลดีในระยะยาว',
        'ระวังอุบัติเหตุจากการเล่นกีฬาหรือกิจกรรมที่ผาดโผน ควรมีความรอบคอบอยู่เสมอ'
    ],
    '18-25': [
        'การนอนดึกและปาร์ตี้หนักเกินไปจะส่งผลเสียต่อสุขภาพในระยะยาว ควรรู้จักสมดุล',
        'เริ่มต้นสร้างนิสัยการออกกำลังกายอย่างสม่ำเสมอ จะช่วยให้มีพลังในการเรียนและทำงาน',
        'ความเครียดจากอนาคตอาจส่งผลต่อสุขภาพจิต ลองหากิจกรรมผ่อนคลายทำบ้าง'
    ],
    '26-35': [
        'การนั่งทำงานนานๆ อาจทำให้ปวดหลังและคอ ควรลุกขึ้นยืดเส้นยืดสายทุกชั่วโมง',
        'ความเครียดจากการทำงานอาจส่งผลต่อสุขภาพ ลองหางานอดิเรกที่ช่วยผ่อนคลายทำ',
        'อย่าละเลยมื้อเช้า เพราะเป็นแหล่งพลังงานสำคัญที่จะช่วยให้คุณทำงานได้อย่างมีประสิทธิภาพ'
    ],
    '36-45': [
        'ถึงเวลาตรวจสุขภาพประจำปีอย่างสม่ำเสมอ การป้องกันดีกว่าการรักษาเสมอ',
        'ให้ความสำคัญกับการกินอาหารที่มีกากใยสูงและลดไขมัน เพื่อสุขภาพหัวใจและหลอดเลือด',
        'การออกกำลังกายที่มีแรงต้านจะช่วยเสริมสร้างมวลกระดูกและกล้ามเนื้อที่เริ่มลดลง'
    ],
    '46-55': [
        'พักผ่อนให้เพียงพอและลดความเครียด วัยนี้ควรใช้ชีวิตให้สบายใจและมีความสุขมากขึ้น',
        'หมั่นตรวจเช็คสายตาและความดันโลหิตเป็นประจำ เพราะเป็นสัญญาณเตือนของร่างกาย',
        'ลองหากิจกรรมใหม่ๆ ที่ท้าทายสมอง เช่น เรียนภาษา เล่นเกมปริศนา เพื่อป้องกันสมองเสื่อม'
    ],
    '55+': [
        'การเดินเล่นในสวนหรือทำกิจกรรมกลางแจ้งเบาๆ จะช่วยให้ร่างกายและจิตใจแจ่มใส',
        'การพบปะเพื่อนฝูงหรือเข้าร่วมกิจกรรมทางสังคมจะช่วยให้สุขภาพจิตดีและไม่รู้สึกโดดเดี่ยว',
        'ดูแลสุขภาพด้วยความรักและเอาใจใส่ กินยาตามเวลาและพบแพทย์ตามนัดอย่างสม่ำเสมอ'
    ]
  }

  const bloodTemplates = healthTemplates[bloodGroup as keyof typeof healthTemplates] || healthTemplates['O']
  const ageAdviceMessages = ageAdvice[ageRange as keyof typeof ageAdvice] || ageAdvice['26-35']

  const baseMessage = bloodTemplates[Math.floor(Math.random() * bloodTemplates.length)]
  const ageMessage = ageAdviceMessages[Math.floor(Math.random() * ageAdviceMessages.length)]

  return `${baseMessage} ${ageMessage}`
}

// Helper functions for number generation
const getAgeMultiplier = (ageRange: AgeRange): number => {
  const multipliers = { '<18': 5, '18-25': 7, '26-35': 11, '36-45': 13, '46-55': 17, '55+': 19 }
  return multipliers[ageRange] || 11
}

const getDayMultiplier = (birthDay: BirthDay): number => {
  const multipliers = {
    'Monday': 2, 'Tuesday': 3, 'Wednesday': 5, 'Thursday': 7,
    'Friday': 11, 'Saturday': 13, 'Sunday': 17
  }
  return multipliers[birthDay] || 7
}

const getBloodMultiplier = (bloodGroup: BloodGroup): number => {
  const multipliers = { 'A': 3, 'B': 5, 'AB': 7, 'O': 11 }
  return multipliers[bloodGroup] || 7
}