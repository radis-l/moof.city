import type { UserData, FortuneResult, AgeRange, BirthDay, BloodGroup } from '@/types'

// Fortune generation based on user data
export const generateFortune = (userData: UserData): FortuneResult => {
  const { ageRange, birthDay, bloodGroup } = userData
  
  // Generate lucky number based on user data
  const luckyNumber = generateLuckyNumber(ageRange, birthDay, bloodGroup)
  
  // Generate personalized predictions
  const relationship = generateRelationshipFortune(birthDay, bloodGroup, ageRange)
  const work = generateWorkFortune(ageRange, birthDay, bloodGroup)
  const health = generateHealthFortune(bloodGroup, ageRange)
  
  return {
    luckyNumber,
    relationship,
    work,
    health,
    generatedAt: new Date().toISOString()
  }
}

// Generate single lucky number (2-digits: 10-99) based on user attributes
const generateLuckyNumber = (
  ageRange: string,
  birthDay: string,
  bloodGroup: string
): number => {
  // Create seed from user data for consistent results
  const ageMultiplier = getAgeMultiplier(ageRange as AgeRange)
  const dayMultiplier = getDayMultiplier(birthDay as BirthDay)
  const bloodMultiplier = getBloodMultiplier(bloodGroup as BloodGroup)
  
  // Generate lucky number between 10-99 (2 digits)
  const seed = (ageMultiplier + dayMultiplier + bloodMultiplier) % 90 + 10
  const luckyNumber = ((seed * 17) % 90) + 10
  
  return luckyNumber
}

// Generate relationship fortune using birthDay + bloodGroup combination
const generateRelationshipFortune = (
  birthDay: string,
  bloodGroup: string,
  _ageRange: string
): string => {
  // Birth day based relationship patterns (longer base texts to match health)
  const dayRelationshipMessages = {
    'Monday': [
      'วันจันทร์ทำให้คุณมีเสน่ห์ดึงดูดคน ความจริงใจเป็นจุดแข็ง คนรอบข้างไว้วางใจ ความสัมพันธ์มั่นคงยั่งยืน',
      'คนเกิดจันทร์มีความซื่อสัตย์สุจริต มีความรับผิดชอบสูง คนรอบข้างจึงเคารพนับถือ ความรักจะหวานชื่น',
      'ความสัมพันธ์ที่มั่นคงเป็นจุดแข็งของคุณ สร้างความเชื่อมั่นได้ดี คู่รักจะไว้วางใจ ครอบครัวอบอุ่น'
    ],
    'Tuesday': [
      'วันอังคารให้พลังในการสร้างสัมพันธ์ มีความกล้าหาญแสดงความรู้สึก คนที่เข้ากันได้จะเข้ามา ความรักเข้มแข็ง',
      'คุณมีความกล้าหาญในการแสดงความรู้สึก ไม่อายที่จะดูแลคนที่รัก ความตรงไปตรงมาน่าหลงใหล มิตรภาพแน่นแฟ้น',
      'ความเป็นผู้นำจะดึงดูดคนที่เข้ากันได้ การตัดสินใจเด็ดขาด ทำให้คนอื่นประทับใจ ความสัมพันธ์มีคุณภาพ'
    ],
    'Wednesday': [
      'วันพุธให้ความฉลาดในการเลือกคน รู้จักคนที่เหมาะสม ไม่หลงผิดง่าย ความรักมีเหตุผล การสื่อสารดีเยี่ยม',
      'การสื่อสารที่ดีเป็นจุดแข็งของคุณ รู้จักฟังและเข้าใจ คนอื่นรู้สึกสบายใจ ความสัมพันธ์ราบรื่น',
      'คุณเข้าใจความรู้สึกคนอื่นได้ดี มีความเห็นอกเห็นใจ คนรอบข้างชอบปรึกษา เป็นที่พึ่งให้คนอื่น'
    ],
    'Thursday': [
      'วันพฤหัสให้โชคดีในเรื่องความรัก มีคนดีเข้ามาในชีวิต โอกาสดีๆ รออยู่ ความสุขมาจากความรัก',
      'คุณมีเสน่ห์ที่ดึงดูดคนดีๆ เข้ามา บุคลิกน่าประทับใจ คนที่พบเจอจะจดจำ ความสัมพันธ์พัฒนาไปได้ดี',
      'ความซื่อสัตย์ทำให้ความสัมพันธ์ยั่งยืน ไม่เล่นเอาเปรียบคนอื่น คู่รักไว้วางใจ ครอบครัวมีความสุข'
    ],
    'Friday': [
      'วันศุกร์ให้ความหวานชื่นในความรัก รู้จักสร้างบรรยากาศดี คนที่รักรู้สึกพิเศษ ความสุขล้นเหลือ',
      'คุณรู้จักการดูแลและเอาใจใส่คนที่รัก ใส่ใจในรายละเอียด ทำให้คนอื่นประทับใจ ความรักงดงาม',
      'ความอ่อนโยนเป็นเสน่ห์พิเศษของคุณ สร้างความอบอุ่น คนรอบข้างรู้สึกสบายใจ ความสัมพันธ์แน่นแฟ้น'
    ],
    'Saturday': [
      'วันเสาร์ให้ความมั่นคงในความสัมพันธ์ เป็นคนที่พึ่งพาได้ คู่รักมั่นใจ ครอบครัวอยู่เย็นเป็นสุข',
      'คุณเป็นคนที่น่าเชื่อถือและพึ่งพาได้ ทำตามสัญญาเสมо คนอื่นไว้วางใจ ความสัมพันธ์มั่นคง',
      'ความรับผิดชอบทำให้คนอื่นเคารพนับถือ ดูแลคนในครอบครัวดี เป็นที่ปรึกษา ความสัมพันธ์อบอุ่น'
    ],
    'Sunday': [
      'วันอาทิตย์ให้ความสว่างในชีวิตคู่ สร้างความสุขให้คนรอบข้าง บุคลิกเปี่ยมแสง ความรักแจ่มใส',
      'คุณมีบุคลิกที่สดใสและน่าดึงดูด เป็นคนที่มองโลกในแง่ดี คนอื่นอยากอยู่ใกล้ ความสัมพันธ์เบิกบาน',
      'ความมีน้ำใจทำให้ทุกคนรักและเข้าใจคุณ ใจกว้าง รู้จักให้อภัย คนรอบข้างรู้สึกอบอุ่น ครอบครัวสุขสันต์'
    ]
  }

  // Blood group modifiers (longer to match health pattern)
  const bloodModifiers = {
    'A': ' ด้วยความละเอียดรอบคอบ การใส่ใจในรายละเอียดทำให้สัมพันธ์ดี',
    'B': ' ด้วยความเป็นตัวของตัวเอง ความมั่นใจในตัวเองดึงดูดคน', 
    'AB': ' ด้วยความเข้าใจคนอื่น การมีจิตใจกว้างขวางช่วยสร้างสัมพันธ์',
    'O': ' ด้วยความเป็นผู้นำ ความมั่นใจทำให้คนอื่นต้องการเข้าใกล้'
  }
  
  const dayMessages = dayRelationshipMessages[birthDay as keyof typeof dayRelationshipMessages] || dayRelationshipMessages['Monday']
  const bloodModifier = bloodModifiers[bloodGroup as keyof typeof bloodModifiers] || bloodModifiers['A']
  
  // Combine birth day message + blood group modifier
  const baseMessage = dayMessages[Math.floor(Math.random() * dayMessages.length)]
  
  return baseMessage + bloodModifier
}

// Generate work fortune
const generateWorkFortune = (
  ageRange: string,
  birthDay: string,
  bloodGroup: string
): string => {
  const workTemplates = {
    '<18': [
      'การเรียนของคุณในช่วงนี้เรียบร้อยดี ผลงานจะโดดเด่นและได้รับการยอมรับ ครูจะเห็นว่าคุณมีความสามารถพิเศษ เตรียมตัวรับรางวัลได้เลย',
      'ได้โอกาสดีๆ ในการแข่งขันหรือแสดงผลงาน ความเก่งของคุณจะเป็นที่จับตา มีโอกาสได้ทุนหรือรางวัลจากการแข่งขัน เพื่อนๆ จะยกย่องและมองเป็นแบบอย่าง',
      'เรื่องการเรียนในช่วงนี้ผลงานจะออกมาโดดเด่น อย่าปล่อยทิ้งความพยายาม ผลของความเข้มแข็งจะมาเอง ครูและผู้ปกครองจะภูมิใจในตัวคุณมาก'
    ],
    '18-25': [
      'งานที่คุณรอคอยคงจะมาเคาะประตูเร็วๆ นี้ เตรียมตัวไว้ให้ดี บางทีอาจต้องสัมภาษณ์งานก่อน ความมั่นใจและความพร้อมจะเป็นกุญแจสำคัญ',
      'ผู้ใหญ่เริ่มเห็นความสามารถของคุณแล้ว การทำงานจะได้รับการยอมรับ ความมั่นใจในการทำงานจะเป็นจุดเด่น จะก้าวไปสู่การเติบโตในอนาคต',
      'มีโอกาสได้เปลี่ยนสายงานให้ดีขึ้น ดูเหมือนคุณมีความสามารถที่จะไปไกล สัมพันธ์กับเพื่อนร่วมงานสำคัญมาก ทักษะการสื่อสารจะเป็นจุดเด่น'
    ],
    '26-35': [
      'การงานของคุณในช่วงนี้จะลื่นไหลไปด้วยดี คนรอบข้างเริ่มเห็นและชื่นชมในตัวคุณ ตำแหน่งงานจะขยับขึ้นไปอีกขั้นแน่นอน งานที่ทำจะได้รับการยอมรับมากขึ้น',
      'เงินเดือนจะขึ้นตามความสามารถที่คุณมี คนรอบข้างจะให้ความช่วยเหลือ ทั้งจากเพื่อนร่วมงานและหัวหน้า ทุกคนจะเริ่มมองคุณในมุมใหม่',
      'จะได้รับมอบหมายงานใหญ่ๆ ที่สำคัญ คุณจะรู้สึกว่าตัวเองมีความสามารถ ได้รับการยอมรับจากทุกคน ความรับผิดชอบที่ได้รับจะมีความหมาย'
    ],
    '36-45': [
      'การลงทุนในช่วงนี้จะมีผลกำไรดีเกินคาด ความเชี่ยวชาญและประสบการณ์ที่สั่งสม จะเป็นทุนในการตัดสินใจ ผลตอบแทนจะดีมากกว่าที่คาดไว้',
      'ธุรกิจส่วนตัวจะเติบโตและขยายตัวดีมาก ความสามารถในการบริหารคนจะเป็นจุดแข็ง งานที่ทำจะให้รายได้เพิ่มขึ้นและมั่นคง ความสำเร็จจะเป็นที่ประจักษ์',
      'จะมีคู่ค้าใหม่เข้ามาร่วมงานกับคุณ คนที่มีความสามารถจะช่วยให้งานเดินหน้าไปได้ สายงานใหม่อาจเข้ามาเสริมให้ธุรกิจขยายตัว ความร่วมมือจะทำให้ผลตอบแทนดีขึ้น'
    ],
    '46-55': [
      'ความเชี่ยวชาญและประสบการณ์จะเป็นที่ต้องการ คุณจะได้รับการยกย่องให้เป็นที่ปรึกษา คนรุ่นใหม่จะมาขอคำแนะนำ ความรู้ที่สั่งสมจะเป็นพื้นฐานในการพัฒนา',
      'จะได้ก้าวขึ้นไปเป็นผู้บริหารหรือหัวหน้าทีม ความสามารถในการบริหารคนเป็นจุดแข็ง ตำแหน่งงานที่รับผิดชอบจะมีความสำคัญ จะได้รับการให้คำปรึกษาที่มีค่า',
      'รายได้ที่ไม่ได้คาดไว้จะมาจากหลายทาง ความสามารถที่สั่งสมจะเป็นทุน ผลงานจะมาจากหลากหลายแหล่ง ความเชี่ยวชาญจะเป็นสิ่งที่ดึงดูดใจ'
    ],
    '55+': [
      'ประสบการณ์และความรู้ที่สั่งสมจะเป็นทุนใช้ได้ ความรู้ที่มีจะเป็นที่พึ่งได้และนับถือ วัยนี้ควรใช้ชีวิตให้สบายขึ้น ผลตอบแทนจะดีกว่าที่คาด',
      'จะได้การยกย่องให้เป็นที่ปรึกษา เป็นแหล่งความรู้สำคัญในวงการ คนที่เคยทำงานกับคุณจะเห็นคุณค่า จะมาขอคำแนะนำและความช่วยเหลือ',
      'มีโอกาสได้ถ่ายทอดความรู้ให้คนรุ่นใหม่ คนที่อายุน้อยกว่าจะมาขอคำแนะนำ ความรู้ที่มีจะมีความหมายและผลกระทบ ต่อคนรอบข้างอย่างมาก'
    ]
  }
  
  const bloodModifiers = {
    'A': 'งานของคุณในช่วงนี้จะลื่นไหลไปด้วยดี คนร่วมงานจะให้ความช่วยเหลือ เพราะคุณเป็นคนระวังและทำงานมีระบบ',
    'B': 'ไอเดียและความคิดสร้างสรรค์จะทำให้งานโดดเด่น คนอื่นจะมองคุณในแง่มุมใหม่ จะเห็นว่าคุณมีความสามารถแตกต่าง',
    'AB': 'การประสานงานและการสื่อสารราบรื่น ทุกฝ่ายจะรู้สึกว่าคุณทำงานได้ดี ได้รับการยอมรับจากทุกคน',
    'O': 'คุณเป็นคนที่มีความเป็นผู้นำตามธรรมชาติ เป็นคนที่นำพาทีมและคนอื่นจะตาม ความเป็นผู้นำจะทำให้ประสบความสำเร็จ'
  }
  
  const ageTemplates = workTemplates[ageRange as keyof typeof workTemplates] || workTemplates['26-35']
  const randomIndex = Math.floor(Math.random() * ageTemplates.length)
  const baseMessage = ageTemplates[randomIndex]
  const bloodMessage = bloodModifiers[bloodGroup as keyof typeof bloodModifiers] || bloodModifiers['A']
  
  return Math.random() > 0.5 ? baseMessage : bloodMessage
}

// Generate health fortune
const generateHealthFortune = (
  bloodGroup: string,
  ageRange: string
): string => {
  const healthTemplates = {
    A: [
      'สุขภาพแข็งแรงขึ้นเรื่อยๆ ระวังเรื่องนอนนะ ภูมิคุ้มกันดี แต่ออกกำลังกายเพิ่มหน่อย ร่างกายก็แข็งแรงตาม',
      'ระบบภูมิคุ้มกันแข็งแรงดี แต่ออกกำลังกายเพิ่มหน่อย สุขภาพจิตดี ร่างกายก็แข็งแรงตาม',
      'สุขภาพจิตดี ร่างกายก็แข็งแรงตาม ระวังเรื่องนอนนะ ออกกำลังกายเป็นประจำจะทำให้สุขภาพดีขึ้นมาก'
    ],
    B: [
      'พลังเต็มเปี่ยม ระวังกินจัดจ้านไป เลือดไหลเวียนดี ออกกำลังกายสม่ำเสมอ จะทำให้สุขภาพดีขึ้นเยอะ',
      'การไหลเวียนของเลือดดี ออกกำลังกายสม่ำเสมอ สุขภาพดีโดยรวม แต่ดูแลท้องหน่อย ระวังอาหารจัดจ้านไป',
      'สุขภาพดีโดยรวม แต่ดูแลท้องหน่อย ระวังกินจัดจ้านไป ออกกำลังกายสม่ำเสมอจะช่วยได้เยอะ'
    ],
    AB: [
      'ร่างกายสมดุลดี สุขภาพค่อยๆ ขึ้น ระวังเครียด พักผ่อนให้เพียงพอ จะทำให้สุขภาพดีขึ้นเรื่อยๆ',
      'ระวังความเครียด พักผ่อนให้เพียงพอ สุขภาพจะดีขึ้นตามวัยเลย ร่างกายสมดุล ทำให้รู้สึกดี',
      'สุขภาพดีขึ้นตามวัยเลย ระวังความเครียด พักผ่อนให้เพียงพอ จะทำให้รู้สึกสดชื่นและมีแรง'
    ],
    O: [
      'พลังแข็งแกร่งธรรมชาติ ดูแลข้อกระดูกด้วย ระบบหัวใจหลอดเลือดแข็งแรง ออกกำลังกายจะช่วยได้เยอะ',
      'หัวใจหลอดเลือดแข็งแรงดี ออกกำลังกายสม่ำเสมอ พลังแข็งแกร่งธรรมชาติ ดูแลข้อกระดูกด้วย',
      'ดื่มน้ำเยอะๆ สุขภาพจะดีขึ้นมาก พลังแข็งแกร่งธรรมชาติ แต่ระวังข้อและกระดูก ออกกำลังกายจะช่วย'
    ]
  }
  
  const ageAdvice = {
    '<18': 'วัยเรียนระวังท่านั่งด้วยนะ การนั่งท่าไม่ดีทำให้กระดูกเสีย',
    '18-25': 'หนุ่มสาวระวังกินดึกไป การนอนดึกทำให้ภูมิคุ้มกันแย่ลง',
    '26-35': 'วัยทำงานหาเวลาออกกำลังกาย การนั่งนานทำให้กล้ามเนื้อลีบ',
    '36-45': 'ตรวจสุขภาพประจำปีสม่ำเสมอ ร่างกายเริ่มเปลี่ยนแปลง',
    '46-55': 'พักผ่อนเพิ่ม ลดความเครียด วัยนี้ควรใช้ชีวิตให้สบาย',
    '55+': 'ดูแลสุขภาพด้วยใจรักนะ วัยนี้ร่างกายต้องเอาใจใส่มากขึ้น'
  }
  
  const bloodTemplates = healthTemplates[bloodGroup as keyof typeof healthTemplates] || healthTemplates['O']
  const randomIndex = Math.floor(Math.random() * bloodTemplates.length)
  const baseMessage = bloodTemplates[randomIndex]
  const ageMessage = ageAdvice[ageRange as keyof typeof ageAdvice] || ageAdvice['26-35']
  
  return baseMessage + ageMessage
}

// Helper functions for number generation
const getAgeMultiplier = (ageRange: AgeRange): number => {
  const multipliers = { '<18': 5, '18-25': 7, '26-35': 11, '36-45': 13, '46-55': 17, '55+': 19 }
  return multipliers[ageRange] || 11
}

const getDayMultiplier = (birthDay: BirthDay): number => {
  const multipliers = {
    'Monday': 2, 'Tuesday': 3, 'Wednesday': 5, 'Thursday': 7,
    'Friday': 11, 'Saturday': 13, 'Sunday': 17
  }
  return multipliers[birthDay] || 7
}

const getBloodMultiplier = (bloodGroup: BloodGroup): number => {
  const multipliers = { 'A': 3, 'B': 5, 'AB': 7, 'O': 11 }
  return multipliers[bloodGroup] || 7
}