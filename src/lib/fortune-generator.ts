import type { UserData, FortuneResult, AgeRange, BirthDay, BloodGroup } from '@/types'

// Fortune generation based on user data
export const generateFortune = (userData: UserData): FortuneResult => {
  const { ageRange, birthDay, bloodGroup } = userData
  
  // Generate lucky number based on user data
  const luckyNumber = generateLuckyNumber(ageRange, birthDay, bloodGroup)
  
  // Generate personalized predictions
  const relationship = generateRelationshipFortune(birthDay, bloodGroup, ageRange)
  const work = generateWorkFortune(ageRange, birthDay, bloodGroup)
  const health = generateHealthFortune(bloodGroup, ageRange)
  
  return {
    luckyNumber,
    relationship,
    work,
    health,
    generatedAt: new Date().toISOString()
  }
}

// Generate single lucky number (2-digits: 10-99) based on user attributes
const generateLuckyNumber = (
  ageRange: string,
  birthDay: string,
  bloodGroup: string
): number => {
  // Create seed from user data for consistent results
  const ageMultiplier = getAgeMultiplier(ageRange as AgeRange)
  const dayMultiplier = getDayMultiplier(birthDay as BirthDay)
  const bloodMultiplier = getBloodMultiplier(bloodGroup as BloodGroup)
  
  // Generate lucky number between 10-99 (2 digits)
  const seed = (ageMultiplier + dayMultiplier + bloodMultiplier) % 90 + 10
  const luckyNumber = ((seed * 17) % 90) + 10
  
  return luckyNumber
}

// Generate relationship fortune  
const generateRelationshipFortune = (
  _birthDay: string,
  bloodGroup: string,
  ageRange: string
): string => {
  const relationshipTemplates = {
    '<18': [
      'ช่วงวัยเรียนนี้ความสัมพันธ์กับเพื่อนๆ จะเป็นสิ่งสำคัญมาก มีเพื่อนใหม่ๆ เข้ามาในชีวิต ความรู้สึกพิเศษกับใครบางคนอาจจะเริ่มต้นขึ้น',
      'เรื่องความชอบใจคนอื่นในวัยนี้เป็นเรื่องธรรมชาติ มุ่งเน้นไปที่การเรียนและการสร้างมิตรภาพที่ดี รุ่นพี่รุ่นน้องจะให้คำแนะนำที่มีประโยชน์',
      'ความสัมพันธ์ในครอบครัวจะเข้มแข็งขึ้น พ่อแม่จะเข้าใจคุณมากขึ้น เพื่อนสนิทจะให้กำลังใจในยามที่ท้อแท้'
    ],
    '18-25': [
      'วัยหนุ่มสาวนี้มีโอกาสพบเจอคนที่ถูกใจ อย่าเร่งรีบมากเกินไป ให้เวลากับการทำความรู้จักกันให้ดี เพื่อนฝูงจะเป็นพยานในความสุขของคุณ',
      'ช่วงนี้จะได้เจอกับความรู้สึกใหม่ๆ ที่ตื่นเต้น แต่ควรสมดุลระหว่างความรักและเป้าหมายในชีวิต ครอบครัวจะให้คำแนะนำที่ดี',
      'ความสัมพันธ์จะเป็นแรงผลักดันให้เติบโต ความรักในช่วงนี้จะหวานชื่น การสร้างมิตรภาพที่ดีจะนำมาซึ่งโอกาสดีๆ ในอนาคต'
    ],
    '26-35': [
      'ช่วงวัยทำงานนี้เริ่มมองหาคู่ชีวิตที่จริงจัง มีคนที่เหมาะสมกำลังเข้ามาใกล้ คิดถึงเรื่องแต่งงานหรือสร้างครอบครัวได้แล้ว',
      'เรื่องความรักในวัยนี้จะเข้มข้นและลึกซึ้ง คู่รักจะช่วยเหลือกันในการสร้างอนาคต อาจจะมีคนในออฟฟิศที่ให้ความสนใจ',
      'ความสัมพันธ์กับครอบครัวจะแน่นแฟ้นมากขึ้น มีโอกาสได้พบเจอคนดีๆ ผ่านงานสังคม ความสุขมาจากการมีคนที่เข้าใจและรักคุณ'
    ],
    '36-45': [
      'วัยกลางคนที่มีเสถียรภาพแล้ว หากยังโสด มีโอกาสพบเจอคนที่มีวุฒิภาวะเหมาะสม หากมีครอบครัวแล้ว ความสัมพันธ์จะแข็งแกร่งขึ้น',
      'ช่วงนี้จะเป็นที่พึ่งของครอบครัวและเพื่อนฝูง ความสัมพันธ์จะมีคุณภาพมากกว่าปริมาณ มีโอกาสได้พบเจอเพื่อนเก่าที่ไม่ได้เจอกันนาน',
      'การเป็นแบบอย่างให้คนรุ่นใหม่จะทำให้รู้สึกมีคุณค่า มีคนมาขอคำปรึกษาในเรื่องต่างๆ ครอบครัวจะเป็นแรงผลักดันสำคัญ'
    ],
    '46-55': [
      'ความสัมพันธ์ในครอบครัวจะเป็นสิ่งสำคัญที่สุด ลูกหลานจะให้ความเคารพและรัก หากยังโสด อาจพบเจอคนที่มีประสบการณ์ชีวิตคล้ายกัน',
      'หลานๆ จะทำให้ชีวิตมีความสุข การท่องเที่ยวกับครอบครัวจะสร้างความทรงจำดี การร่วมกิจกรรมเพื่อสังคมจะขยายวงสัมพันธ์',
      'การใช้ชีวิตอย่างเรียบง่ายจะนำมาซึ่งความสุข เพื่อนเก่าจะติดต่อมาอีกครั้ง หากมีคู่ชีวิต จะมีเวลาให้กันมากขึ้น'
    ],
    '55+': [
      'วัยผู้สูงอายุที่เต็มไปด้วยความอบอุ่น ลูกหลานจะมาเยี่ยมและให้ความเอาใจใส่ หากมีคู่ชีวิต จะมีเวลาให้กันอย่างเต็มที่',
      'เพื่อนๆ ในวัยเดียวกันจะให้กำลังใจซึ่งกันและกัน ลูกๆ จะกลับมาขอคำปรึกษาในเรื่องสำคัญ การมีส่วนร่วมในการเลี้ยงดูหลานจะสร้างความสุข',
      'ความรักที่บริสุทธิ์จากลูกหลานจะเป็นของขวัญที่ดีที่สุด หากได้พบเจอคนที่มีประสบการณ์ชีวิตคล้ายกัน ความสุขเรียบง่ายจะเป็นความสุขแท้จริง'
    ]
  }
  
  const bloodRelationshipMessages = {
    'A': 'ด้วยนิสัยที่ละเอียดและใส่ใจ คุณจึงสร้างความสัมพันธ์ที่มีคุณภาพได้ดี คนรอบข้างจะรู้สึกอบอุ่นและปลอดภัยเมื่ออยู่กับคุณ',
    'B': 'ความเป็นตัวของตัวเองจะดึงดูดคนที่เข้าใจคุณ อย่าเปลี่ยนแปลงตัวเองเพื่อใครนะ คนที่ใช่จะรักในสิ่งที่คุณเป็น',
    'AB': 'ความซับซ้อนของความคิดทำให้คุณเข้าใจคนอื่นได้ดี คุณสามารถสร้างความสัมพันธ์ที่ลึกซึ้งกับหลายคนได้',
    'O': 'ความเป็นผู้นำตามธรรมชาติจะทำให้คนอื่นหันมาพึ่งพิงคุณ ใช้อิทธิพลนี้ในการสร้างสรรค์สิ่งดีๆ ให้กับคนรอบข้าง'
  }
  
  const ageTemplates = relationshipTemplates[ageRange as keyof typeof relationshipTemplates] || relationshipTemplates['26-35']
  const bloodMessage = bloodRelationshipMessages[bloodGroup as keyof typeof bloodRelationshipMessages] || bloodRelationshipMessages['A']
  
  // Use the same pattern as work fortune - randomly choose either age-based OR blood-based message
  return Math.random() > 0.5 
    ? ageTemplates[Math.floor(Math.random() * ageTemplates.length)]
    : bloodMessage
}

// Generate work fortune
const generateWorkFortune = (
  ageRange: string,
  birthDay: string,
  bloodGroup: string
): string => {
  const workTemplates = {
    '<18': [
      'การเรียนของคุณในช่วงนี้เรียบร้อยดี ผลงานจะโดดเด่นและได้รับการยอมรับ ครูจะเห็นว่าคุณมีความสามารถพิเศษ เตรียมตัวรับรางวัลได้เลย',
      'ได้โอกาสดีๆ ในการแข่งขันหรือแสดงผลงาน ความเก่งของคุณจะเป็นที่จับตา มีโอกาสได้ทุนหรือรางวัลจากการแข่งขัน เพื่อนๆ จะยกย่องและมองเป็นแบบอย่าง',
      'เรื่องการเรียนในช่วงนี้ผลงานจะออกมาโดดเด่น อย่าปล่อยทิ้งความพยายาม ผลของความเข้มแข็งจะมาเอง ครูและผู้ปกครองจะภูมิใจในตัวคุณมาก'
    ],
    '18-25': [
      'งานที่คุณรอคอยคงจะมาเคาะประตูเร็วๆ นี้ เตรียมตัวไว้ให้ดี บางทีอาจต้องสัมภาษณ์งานก่อน ความมั่นใจและความพร้อมจะเป็นกุญแจสำคัญ',
      'ผู้ใหญ่เริ่มเห็นความสามารถของคุณแล้ว การทำงานจะได้รับการยอมรับ ความมั่นใจในการทำงานจะเป็นจุดเด่น จะก้าวไปสู่การเติบโตในอนาคต',
      'มีโอกาสได้เปลี่ยนสายงานให้ดีขึ้น ดูเหมือนคุณมีความสามารถที่จะไปไกล สัมพันธ์กับเพื่อนร่วมงานสำคัญมาก ทักษะการสื่อสารจะเป็นจุดเด่น'
    ],
    '26-35': [
      'การงานของคุณในช่วงนี้จะลื่นไหลไปด้วยดี คนรอบข้างเริ่มเห็นและชื่นชมในตัวคุณ ตำแหน่งงานจะขยับขึ้นไปอีกขั้นแน่นอน งานที่ทำจะได้รับการยอมรับมากขึ้น',
      'เงินเดือนจะขึ้นตามความสามารถที่คุณมี คนรอบข้างจะให้ความช่วยเหลือ ทั้งจากเพื่อนร่วมงานและหัวหน้า ทุกคนจะเริ่มมองคุณในมุมใหม่',
      'จะได้รับมอบหมายงานใหญ่ๆ ที่สำคัญ คุณจะรู้สึกว่าตัวเองมีความสามารถ ได้รับการยอมรับจากทุกคน ความรับผิดชอบที่ได้รับจะมีความหมาย'
    ],
    '36-45': [
      'การลงทุนในช่วงนี้จะมีผลกำไรดีเกินคาด ความเชี่ยวชาญและประสบการณ์ที่สั่งสม จะเป็นทุนในการตัดสินใจ ผลตอบแทนจะดีมากกว่าที่คาดไว้',
      'ธุรกิจส่วนตัวจะเติบโตและขยายตัวดีมาก ความสามารถในการบริหารคนจะเป็นจุดแข็ง งานที่ทำจะให้รายได้เพิ่มขึ้นและมั่นคง ความสำเร็จจะเป็นที่ประจักษ์',
      'จะมีคู่ค้าใหม่เข้ามาร่วมงานกับคุณ คนที่มีความสามารถจะช่วยให้งานเดินหน้าไปได้ สายงานใหม่อาจเข้ามาเสริมให้ธุรกิจขยายตัว ความร่วมมือจะทำให้ผลตอบแทนดีขึ้น'
    ],
    '46-55': [
      'ความเชี่ยวชาญและประสบการณ์จะเป็นที่ต้องการ คุณจะได้รับการยกย่องให้เป็นที่ปรึกษา คนรุ่นใหม่จะมาขอคำแนะนำ ความรู้ที่สั่งสมจะเป็นพื้นฐานในการพัฒนา',
      'จะได้ก้าวขึ้นไปเป็นผู้บริหารหรือหัวหน้าทีม ความสามารถในการบริหารคนเป็นจุดแข็ง ตำแหน่งงานที่รับผิดชอบจะมีความสำคัญ จะได้รับการให้คำปรึกษาที่มีค่า',
      'รายได้ที่ไม่ได้คาดไว้จะมาจากหลายทาง ความสามารถที่สั่งสมจะเป็นทุน ผลงานจะมาจากหลากหลายแหล่ง ความเชี่ยวชาญจะเป็นสิ่งที่ดึงดูดใจ'
    ],
    '55+': [
      'ประสบการณ์และความรู้ที่สั่งสมจะเป็นทุนใช้ได้ ความรู้ที่มีจะเป็นที่พึ่งได้และนับถือ วัยนี้ควรใช้ชีวิตให้สบายขึ้น ผลตอบแทนจะดีกว่าที่คาด',
      'จะได้การยกย่องให้เป็นที่ปรึกษา เป็นแหล่งความรู้สำคัญในวงการ คนที่เคยทำงานกับคุณจะเห็นคุณค่า จะมาขอคำแนะนำและความช่วยเหลือ',
      'มีโอกาสได้ถ่ายทอดความรู้ให้คนรุ่นใหม่ คนที่อายุน้อยกว่าจะมาขอคำแนะนำ ความรู้ที่มีจะมีความหมายและผลกระทบ ต่อคนรอบข้างอย่างมาก'
    ]
  }
  
  const bloodMultiplier = {
    'A': 'งานของคุณในช่วงนี้จะลื่นไหลไปด้วยดีนะ คนร่วมงานจะให้ความช่วยเหลือ เพราะคุณเป็นคนระวังและทำงานมีระบบ ผลงานที่ออกมาจะดีมาก',
    'B': 'ไอเดียและความคิดสร้างสรรค์จะทำให้งานโดดเด่น คนอื่นจะมองคุณในแง่มุมใหม่ จะเห็นว่าคุณมีความสามารถแตกต่าง ความคิดสร้างสรรค์จะเป็นจุดเด่น',
    'AB': 'การประสานงานและการสื่อสารราบรื่น ทุกฝ่ายจะรู้สึกว่าคุณทำงานได้ดี ได้รับการยอมรับจากทุกคน ตำแหน่งงานจะมีความก้าวหน้า',
    'O': 'คุณเป็นคนที่มีความเป็นผู้นำตามธรรมชาติ เป็นคนที่นำพาทีมและคนอื่นจะตาม ความเป็นผู้นำจะทำให้ประสบความสำเร็จ คนอื่นจะเชื่อในความสามารถของคุณ'
  }
  
  const ageTemplates = workTemplates[ageRange as keyof typeof workTemplates] || workTemplates['26-35']
  const randomIndex = Math.floor(Math.random() * ageTemplates.length)
  const baseMessage = ageTemplates[randomIndex]
  const bloodMessage = bloodMultiplier[bloodGroup as keyof typeof bloodMultiplier] || bloodMultiplier['A']
  
  return Math.random() > 0.5 ? baseMessage : bloodMessage
}

// Generate health fortune
const generateHealthFortune = (
  bloodGroup: string,
  ageRange: string
): string => {
  const healthTemplates = {
    A: [
      'สุขภาพแข็งแรงขึ้นเรื่อยๆ ระวังเรื่องนอนนะ ภูมิคุ้มกันดี แต่ออกกำลังกายเพิ่มหน่อย ร่างกายก็แข็งแรงตาม',
      'ระบบภูมิคุ้มกันแข็งแรงดี แต่ออกกำลังกายเพิ่มหน่อย สุขภาพจิตดี ร่างกายก็แข็งแรงตาม',
      'สุขภาพจิตดี ร่างกายก็แข็งแรงตาม ระวังเรื่องนอนนะ ออกกำลังกายเป็นประจำจะทำให้สุขภาพดีขึ้นมาก'
    ],
    B: [
      'พลังเต็มเปี่ยม ระวังกินจัดจ้านไป เลือดไหลเวียนดี ออกกำลังกายสม่ำเสมอ จะทำให้สุขภาพดีขึ้นเยอะ',
      'การไหลเวียนของเลือดดี ออกกำลังกายสม่ำเสมอ สุขภาพดีโดยรวม แต่ดูแลท้องหน่อย ระวังอาหารจัดจ้านไป',
      'สุขภาพดีโดยรวม แต่ดูแลท้องหน่อย ระวังกินจัดจ้านไป ออกกำลังกายสม่ำเสมอจะช่วยได้เยอะ'
    ],
    AB: [
      'ร่างกายสมดุลดี สุขภาพค่อยๆ ขึ้น ระวังเครียด พักผ่อนให้เพียงพอ จะทำให้สุขภาพดีขึ้นเรื่อยๆ',
      'ระวังความเครียด พักผ่อนให้เพียงพอ สุขภาพจะดีขึ้นตามวัยเลย ร่างกายสมดุล ทำให้รู้สึกดี',
      'สุขภาพดีขึ้นตามวัยเลย ระวังความเครียด พักผ่อนให้เพียงพอ จะทำให้รู้สึกสดชื่นและมีแรง'
    ],
    O: [
      'พลังแข็งแกร่งธรรมชาติ ดูแลข้อกระดูกด้วย ระบบหัวใจหลอดเลือดแข็งแรง ออกกำลังกายจะช่วยได้เยอะ',
      'หัวใจหลอดเลือดแข็งแรงดี ออกกำลังกายสม่ำเสมอ พลังแข็งแกร่งธรรมชาติ ดูแลข้อกระดูกด้วย',
      'ดื่มน้ำเยอะๆ สุขภาพจะดีขึ้นมาก พลังแข็งแกร่งธรรมชาติ แต่ระวังข้อและกระดูก ออกกำลังกายจะช่วย'
    ]
  }
  
  const ageAdvice = {
    '<18': 'วัยเรียนระวังท่านั่งด้วยนะ การนั่งท่าไม่ดีทำให้กระดูกเสีย',
    '18-25': 'หนุ่มสาวระวังกินดึกไป การนอนดึกทำให้ภูมิคุ้มกันแย่ลง',
    '26-35': 'วัยทำงานหาเวลาออกกำลังกาย การนั่งนานทำให้กล้ามเนื้อลีบ',
    '36-45': 'ตรวจสุขภาพประจำปีสม่ำเสมอ ร่างกายเริ่มเปลี่ยนแปลง',
    '46-55': 'พักผ่อนเพิ่ม ลดความเครียด วัยนี้ควรใช้ชีวิตให้สบาย',
    '55+': 'ดูแลสุขภาพด้วยใจรักนะ วัยนี้ร่างกายต้องเอาใจใส่มากขึ้น'
  }
  
  const bloodTemplates = healthTemplates[bloodGroup as keyof typeof healthTemplates] || healthTemplates['O']
  const randomIndex = Math.floor(Math.random() * bloodTemplates.length)
  const baseMessage = bloodTemplates[randomIndex]
  const ageMessage = ageAdvice[ageRange as keyof typeof ageAdvice] || ageAdvice['26-35']
  
  return baseMessage + ageMessage
}

// Helper functions for number generation
const getAgeMultiplier = (ageRange: AgeRange): number => {
  const multipliers = { '<18': 5, '18-25': 7, '26-35': 11, '36-45': 13, '46-55': 17, '55+': 19 }
  return multipliers[ageRange] || 11
}

const getDayMultiplier = (birthDay: BirthDay): number => {
  const multipliers = {
    'Monday': 2, 'Tuesday': 3, 'Wednesday': 5, 'Thursday': 7,
    'Friday': 11, 'Saturday': 13, 'Sunday': 17
  }
  return multipliers[birthDay] || 7
}

const getBloodMultiplier = (bloodGroup: BloodGroup): number => {
  const multipliers = { 'A': 3, 'B': 5, 'AB': 7, 'O': 11 }
  return multipliers[bloodGroup] || 7
}